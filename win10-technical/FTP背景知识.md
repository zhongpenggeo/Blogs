---
title: FTP背景知识
date: 2020-09-28 09:55:31
categories:
- Win10
---
#### 端口

ftp通过tcp连接，但是，

ftp涉及两个端口：

1. 21，数据端口
2. 20，命令端口

## 模式

#### 主动模式

FTP**客户端**从任意的非特殊的端口（N > 1023）连入到FTP服务器的命令端口--21端口。然后客户端在N+1（N+1 >= 1024）端口监听，并且通过N+1（N+1 >= 1024）端口发送命令给FTP服务器。服务器会反过来连接用户本地指定的数据端口，比如20端口。

主动模式的FTP的 主要问题实际上落在客户端。FTP 的客户端并不会主动连接到服务器的数据端口，而是是告诉服务器它正在监听哪个端口，然后服务器发起连接到客户端上指定的端口。但是，**这样的连接有时候会被客户端的防火墙阻止**。

#### 被动模式

为了解决服务器主动发起到客户端连接会被阻止的问题，另一种更完善的工作模式出现了，它就是 FTP 的被动模式，缩写作 PASV，它工作的前提是客户端明确告知 FTP 服务器它使用被动模式。


在被动模式的 FTP 中，客户端启动到服务器的两个连接，**解决了防火墙阻止从服务器到客户端的传入数据端口连接的问题**。FTP 连接建立后，客户端在本地打开两个随机的非系统端口 N 和 N + 1(N > 1023)。第一个端口连接服务器上的 21 端口，但是客户端这次将会发出 PASV 命令，也就是不允许服务器连接回其数据端口。这样，服务器随后会打开一个随机的非系统端口 P (P > 1023)，并将 P 发送给客户端作为 PASV 命令的响应。然后客户端启动从端口 N+1 到端口 P 的连接来传输数据。

参考资料：https://zhuanlan.zhihu.com/p/93190903