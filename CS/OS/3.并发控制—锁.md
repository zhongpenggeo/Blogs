## 自旋锁

需要交换

#### 原子指令

Bus Lock

lock是一个指令前缀，该字节表示后面皆为原子指令；

#### 缺点：

只有一个线程能得到锁，另一个陷入循环

scalability

- 性能问题：
  - 缓存同步开销很大
  - 其他线程空转（线程越多、利用率越低）
  - 得到自旋锁的线程可能被操作系统切换出去
  - 操作系统不能感知线程在做什么
  - 资源浪费

#### 使用场景

1. 临界区几乎不拥堵：只有一个线程进入临界区，几乎不争抢锁
2. 持有自旋锁时进制执行流切换：线程自己无法决定

使用场景：操作系统内核的并发数据结构

## 互斥锁

睡眠锁

上锁失败不再占用CPU

但是即使上锁成功也需要进入内核。

## Futex

进一步优化：上锁成功无需进入内核