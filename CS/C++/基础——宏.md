---
jichutitle: 0.1 宏定义
date: 2021-07-27 09:59:04
categories:
- C++
---
宏就是编译器在预处理阶段进行的 **文本替换** 。

## 宏一般用途

### 1. 定义宏常量

```C
#include<stdio.h>
#define M 20
```

也可以定义宏函数，在下文中调用。



#### 2. 防止重复包含

预处理器变量：在编写头文件时，我们需要引入一些额外的预处理设置，预处理器允许我们自定义变量。预处理器变量的名字在程序中必须是唯一的。任何与预处理器变量相匹配的名字的使用都关联到该预处理器变量，而避免冲突，预处理器变量一般使用大写的英文字符表示。预处理器变量有两种状态：
已定义和未定义。#define接收一个标识符，并定义该标识符为预处理器变量。

```C++
#ifndef BODYDEF_H 

#define BODYDEF_H 

 //头文件内容 
#endif
```

需要注意的是，防止头文件被重引用，还可以使用#pragma once来解决。使用#pragma once 后，在编译时，编译器只对该文件编译一次；与宏定义相比，#pragma once具有更快的速度和更高的效率，但是需要指出的是:

pragma并不是所有的编译器都支持，可移植性较差。

### 3. 条件编译



### 4. 宏函数

宏函数的优点在于**避免函数调用**，提高程序效率。

```C++
define MAX(a,b) ((a)<(b)?(b):(a))
```

 函数的调用是需要一定的时间和空间代价的。因为系统在调用函数时，需要保留”现场”，即将程序要执行的指令的下一条指令的位置压入栈，然后转入调用函数去执行，调用完函数后再返回主调函数，恢复”现场”，返回到栈里保存的的下一条指令的位置继续执行。所以函数的调用需要额外的时间和空间代价。

      而宏函数则不存在上述问题，宏函数在预编译时，同函数定义的代码来替换函数名，将函数代码段嵌入到当前程序，不会产生函数调用，所以会省去普通函数保留现场恢复现场的时间，但因为要将定义的函数体嵌入到当前程序，所以不可避免的会占用额外的存储空间。在频繁调用同一个宏的时候，该现象尤其明显。
同时需要注意的是inline标识符。inline也将函数定义为内联的。但是使用内联函数需要注意的是：函数体必须十分简单，不能含有循环、条件、选择等复杂结构，否则就不能作为内联函数了。

而使用宏函数则完全由代码本身控制。但在使用宏函数的时候，需要明确的是宏函数只是简单的替换，需要注意括号的使用。

参考：[深度解析C/C++中的宏是什么？有什么作用呢？_dreamispossible的博客-CSDN博客_c++中宏是什么意思](https://blog.csdn.net/dreamispossible/article/details/80686858)